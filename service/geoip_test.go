package service

import (
	"testing"

	"github.com/icrowley/fake"
)

func BenchmarkGeoIP(b *testing.B) {
	service, err := NewGeoIP("../data/geolite2_city.mmdb")
	if err != nil {
		b.Fatalf("%v", err)
	}
	defer service.Close()

	for n := 0; n < b.N; n++ {
		ip := fake.IPv4()

		_, err := service.LocationByIP(ip)
		if err != nil && err != ErrLocationUnknown {
			b.Fatalf("geo ip lookup for '%s' failed with error '%s'", ip, err)
		}
	}
}
