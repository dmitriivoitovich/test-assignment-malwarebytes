# Suspicious User Session System (SUSS)

This is a suspicious login detection system, the next generation of early warning detection system. 
All the distances and speed are presented in miles and miles per hour.

## How to build and run

    docker build -t suss -f .infra/docker/Dockerfile .
    docker run --rm --name suss -it -p 5000:80 suss

### Request examples

    curl -X POST http://localhost:5000/v1/event \
        -H 'Content-Type: application/json' \ 
        -d '{"username":"ivan","unix_timestamp":1511026500,"event_uuid":"85ad929a-db03-4bf4-9541-8f728fa12e10","ip_address":"8.8.8.8"}'

    curl -X POST http://localhost:5000/v1/event \
        -H 'Content-Type: application/json' \
        -d '{"username":"ivan","unix_timestamp":1511026600,"event_uuid":"85ad929a-db03-4bf4-9541-8f728fa12e11","ip_address":"85.253.237.59"}'

    curl -X POST http://localhost:5000/v1/event \
        -H 'Content-Type: application/json' \
        -d '{"username":"ivan","unix_timestamp":1511126700,"event_uuid":"85ad929a-db03-4bf4-9541-8f728fa12e12","ip_address":"80.253.237.59"}'

### Response examples

    {
        "currentGeo": {
            "lat": 59.433,
            "lon": 24.7323,
            "radius": 3
        },
        "travelToCurrentGeoSuspicious": true,
        "travelFromCurrentGeoSuspicious": false,
        "precedingIpAccess": {
            "lat": 37.751,
            "lon": -97.822,
            "radius": 621,
            "speed": 201316,
            "ip": "8.8.8.8",
            "timestamp": 1511026500
        },
        "subsequentIpAccess": {
            "lat": 56.0133,
            "lon": 92.7885,
            "radius": 62,
            "speed": 89,
            "ip": "80.253.237.59",
            "timestamp": 1511126700
        }
    }

### How to run tests

    % go test ./...
        ?   	github.com/dmitriivoitovich/test-assignment-malwarebytes	[no test files]
        ok  	github.com/dmitriivoitovich/test-assignment-malwarebytes/controller	(cached)
        ?   	github.com/dmitriivoitovich/test-assignment-malwarebytes/controller/request	[no test files]
        ?   	github.com/dmitriivoitovich/test-assignment-malwarebytes/controller/response	[no test files]
        ?   	github.com/dmitriivoitovich/test-assignment-malwarebytes/repository	[no test files]
        ?   	github.com/dmitriivoitovich/test-assignment-malwarebytes/repository/db	[no test files]
        ok  	github.com/dmitriivoitovich/test-assignment-malwarebytes/service	(cached)

## Dependencies

1. github.com/labstack/echo - web framework for route, context and error handling and logging
2. github.com/go-playground/validator/v10 - data validation library, used for input validation
3. github.com/satori/go.uuid - uuid data type implementation
4. github.com/oschwald/geoip2-golang - geoip data files reader
5. github.com/umahmood/haversine - haversine formula implementation
6. gorm.io/gorm - ORM library for querying DB
7. gorm.io/driver/sqlite - sqlite driver for the ORM
8. github.com/stretchr/testify - test framework
9. github.com/icrowley/fake - test data generator
