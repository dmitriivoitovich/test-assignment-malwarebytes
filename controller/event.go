package controller

import (
	"fmt"
	"log"
	"net/http"

	"github.com/dmitriivoitovich/test-assignment-malwarebytes/service"
	"github.com/labstack/echo/v4"
)

type Event struct {
	geoIP *service.GeoIP
}

func NewEvent(geoIP *service.GeoIP) *Event {
	return &Event{
		geoIP: geoIP,
	}
}

func (e *Event) PostEvent(c echo.Context) error {
	loc, err := e.geoIP.LocationByIP("8.8.8.8")
	if err != nil {
		log.Fatal(err)

		return nil
	}

	res := fmt.Sprintf("Coordinates: %v, %v, %v\n", loc.Latitude, loc.Longitude, loc.AccuracyRadius)

	return c.String(http.StatusOK, res)
}
